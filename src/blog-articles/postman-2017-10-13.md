# API testing with Postman and Newman

A project that I have been working on recently involved creating an API written in NodeJS that would provide data for a separate application used by customer service staff members. It was essential that the data that this API return be very accurate as if it wasn't, it could potentially cause extra costs to the company.

I wanted to not only have unit tests across this code, but be able to automatically run a suite of full stack tests whenever code was changed. To do this I decided to use a combination of [Postman](https://www.getpostman.com/) and an NPM package [Newman](https://www.npmjs.com/package/newman)

Postman is a tool that most developers would be familiar with as it allows you to make requests to APIs and see the response. I wont go too much into its features as its very well documented on the Postman website, but the main one I wanted to mention is that you can run assertions on the response object when the request completes. The end goal is to be able to run the tests as part of your CI.

## Example Request and tests

As postman provides a sample API to use as a demo, I will use that for this example.

Request GET: `https://postman-echo.com/get?test=123`

Response: 
```json
{
    "args": {
        "test": "123"
    },
    "headers": {
        "host": "postman-echo.com",
        "accept": "*/*",
        "accept-encoding": "gzip, deflate",
        "cache-control": "no-cache",
        "cookie": "sails.sid=s%3AU2xNNidPBz5thtnuyNsLvbKHM_XwZkFV.y11pszMd8Ec%2BlkGf7T9S%2FpKh%2FedrzJciHk0sjGihxi8",
        "postman-token": "4a17f0d8-68e2-40b4-9f00-acfd9bd1fd6b",
        "user-agent": "PostmanRuntime/6.4.1",
        "x-forwarded-port": "443",
        "x-forwarded-proto": "https"
    },
    "url": "https://postman-echo.com/get?test=123"
}
```

## Running tests

The tests are executed inside the Postman Sandbox, which is a Javascript execution environment that contains some helper libraries such as lodash and cheerio, with the ability to set environment variables and run pre request scripts.

Using Javascript you can write a suite of tests to be executed after the response completes. For example to test that the HTTP status code is 200 is as simple as
`tests["Status code is 200"] = responseCode.code === 200;`

Parsing the response and testing the content of the response is quite simple as well.

```json

var response = JSON.parse(responseBody);

```


